## Queries envolvendo tabelas de sistema

### Obter informações sobre as constraints
```
SELECT t1.CONSTRAINT_NAME, t1.COLUMN_NAME, t1.ORDINAL_POSITION, t1.TABLE_NAME
FROM Information_Schema.Key_Column_Usage t1, Information_Schema.Referential_constraints t2 
WHERE t2.Constraint_name = '{0}'
AND t2.Unique_Constraint_Name = t1.Constraint_Name
ORDER BY Ordinal_Position
```

### Obter as colunas da tabela pelo schema e tabela
```
SELECT COLUMN_NAME, DATA_TYPE, IS_NULLABLE, CHARACTER_MAXIMUM_LENGTH, NUMERIC_PRECISION, NUMERIC_SCALE, CHARACTER_SET_NAME, COLLATION_NAME, TABLE_NAME, COLUMNPROPERTY(OBJECT_ID(TABLE_NAME), COLUMN_NAME, 'IsIdentity') AS IS_IDENTITY
FROM INFORMATION_SCHEMA.COLUMNS
WHERE Table_Name = '{0}'
AND Table_Schema ='{1}'
ORDER BY ORDINAL_POSITION
```

### Obter foreign-keys pelo catálogo e tabela
```
SELECT t1.CONSTRAINT_NAME, t1.COLUMN_NAME, t1.ORDINAL_POSITION
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE t1, INFORMATION_SCHEMA.TABLE_CONSTRAINTS t2
WHERE t2.TABLE_CATALOG = t1.TABLE_CATALOG
AND t2.TABLE_SCHEMA = t1.TABLE_SCHEMA
AND t2.TABLE_NAME = t1.TABLE_NAME
AND t2.CONSTRAINT_NAME = t1.CONSTRAINT_NAME
AND t1.TABLE_Catalog = '{0}' AND t1.TABLE_NAME = '{1}'
AND CONSTRAINT_TYPE = 'FOREIGN KEY'
ORDER BY ORDINAL_POSITION
```

### Obter tabelas do catálogo
```
SELECT TABLE_NAME, TABLE_SCHEMA OWNER, REFDATE CREATE_TIME 
FROM INFORMATION_SCHEMA.TABLES , sysobjects###
WHERE TABLE_NAME = sysobjects.[name] 
AND TABLE_CATALOG = '{0}' AND TABLE_TYPE = 'BASE TABLE' ORDER BY 1
```

### Obter tabelas pelo nome da coluna
```
SELECT t.name AS table_name,
SCHEMA_NAME(schema_id) AS schema_name,
c.name AS column_name
FROM sys.tables AS t
INNER JOIN sys.columns c ON t.OBJECT_ID = c.OBJECT_ID
WHERE c.name LIKE '%{0}%'
ORDER BY schema_name, table_name;
```

### Obter as constraints da tabela
```
SELECT KCU.TABLE_NAME, KCU.COLUMN_NAME, TC.CONSTRAINT_NAME, TC.CONSTRAINT_TYPE, KCU.ORDINAL_POSITION,
(SELECT KCU1.TABLE_NAME
 FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU1
 WHERE KCU1.CONSTRAINT_NAME = (
 	SELECT RC1.UNIQUE_CONSTRAINT_NAME 
	FROM INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS RC1
	INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU1 ON KCU1.CONSTRAINT_NAME = RC1.CONSTRAINT_NAME
	WHERE RC1.CONSTRAINT_NAME = TC.CONSTRAINT_NAME
	AND TC.CONSTRAINT_TYPE = 'FOREIGN KEY'
)) AS 'REFERENCE_TABLE',
(SELECT KCU1.COLUMN_NAME
 FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU1
 WHERE KCU1.CONSTRAINT_NAME = (
 	SELECT RC1.UNIQUE_CONSTRAINT_NAME 
	FROM INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS RC1
	INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU1 ON KCU1.CONSTRAINT_NAME = RC1.CONSTRAINT_NAME
	WHERE RC1.CONSTRAINT_NAME = TC.CONSTRAINT_NAME
	AND TC.CONSTRAINT_TYPE = 'FOREIGN KEY'
)) AS 'REFERENCE_COLUMN'
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE KCU
INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS TC ON TC.CONSTRAINT_NAME = KCU.CONSTRAINT_NAME
WHERE TC.TABLE_NAME = '{0}'
```

### Obter todas as views
```
SELECT TABLE_NAME, TABLE_SCHEMA OWNER, REFDATE CREATE_TIME , VIEW_DEFINITION
FROM INFORMATION_SCHEMA.VIEWS , sysobjects
WHERE Table_Name = sysobjects.[name] 
ORDER BY 1
```

### Obter texto em uma stored procedure
```
SELECT DISTINCT O.Name, O.Type_desc
FROM sys.sql_modules M
INNER JOIN sys.objects O ON M.Object_id = O.Object_id
WHERE M.Definition Like '%[text_to_search]%';
```
